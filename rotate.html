<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .container {
        width: 100%;
        height: 100%;
        max-width: 726px;
        min-width: 320px;
        margin: 0 auto;
      }

      .img-container {
        border: 1px solid #ccc;
        width: 100%;
        max-width: 640px;
        height: 480px; /* Set height for the container */
        margin: 0 auto;
        padding: 0;
        cursor: ew-resize;
        overflow: hidden; /* Ensure the zoomed image doesn't overflow the container */
        background-size: cover; /* Cover the entire container */
        background-position: center; /* Center the image */
      }

      .img360 {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        line-height: 0;
      }

      .zoom {
        background-size: 200%; /* Zoom factor */
        transition: background-size 0.3s ease-in-out,
          background-position 0.3s ease-in-out; /* Smooth zoom transition */
      }

      #preload-imgs {
        display: none;
      }
      .img-zoom-container {
        position: relative;
      }

      .img-zoom-lens {
        position: absolute;
        border: 1px solid #d4d4d4;
        /*set the size of the lens:*/
        width: 40px;
        height: 40px;
      }

      .img-zoom-result {
        border: 1px solid #d4d4d4;
        /*set the size of the result div:*/
        width: 300px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div
        class="img-container"
        id="imgContainer"
        style="
          background-image: url('http://woosterwebdesign.com/experiments/images/car_slides/car_(1).jpg');
        "
      >
        <div class="img360">
          <!-- Removed img element -->
        </div>
      </div>

      <div class="caption"></div>
      <div id="preload-imgs"></div>
      <div class="img-zoom-container img-container img360">
        <img
          id="myimage"
          id="imgContainer"
          src="http://woosterwebdesign.com/experiments/images/car_slides/car_(1).jpg"
          width="300"
          height="240"
        />
        <div id="myresult" class="img-zoom-result"></div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.19/jquery.touchSwipe.min.js"></script>
    <script>
      imageZoom("myimage", "myresult");
      function imageZoom(imgID, resultID) {
        var img, lens, result, cx, cy;
        img = document.getElementById(imgID);
        result = document.getElementById(resultID);
        /*create lens:*/
        lens = document.createElement("DIV");
        lens.setAttribute("class", "img-zoom-lens");
        /*insert lens:*/
        img.parentElement.insertBefore(lens, img);
        /*calculate the ratio between result DIV and lens:*/
        cx = result.offsetWidth / lens.offsetWidth;
        cy = result.offsetHeight / lens.offsetHeight;
        /*set background properties for the result DIV:*/
        result.style.backgroundImage = "url('" + img.src + "')";
        result.style.backgroundSize =
          img.width * cx + "px " + img.height * cy + "px";
        /*execute a function when someone moves the cursor over the image, or the lens:*/
        lens.addEventListener("mousemove", moveLens);
        img.addEventListener("mousemove", moveLens);
        /*and also for touch screens:*/
        lens.addEventListener("touchmove", moveLens);
        img.addEventListener("touchmove", moveLens);
        function moveLens(e) {
          var pos, x, y;
          /*prevent any other actions that may occur when moving over the image:*/
          e.preventDefault();
          /*get the cursor's x and y positions:*/
          pos = getCursorPos(e);
          /*calculate the position of the lens:*/
          x = pos.x - lens.offsetWidth / 2;
          y = pos.y - lens.offsetHeight / 2;
          /*prevent the lens from being positioned outside the image:*/
          if (x > img.width - lens.offsetWidth) {
            x = img.width - lens.offsetWidth;
          }
          if (x < 0) {
            x = 0;
          }
          if (y > img.height - lens.offsetHeight) {
            y = img.height - lens.offsetHeight;
          }
          if (y < 0) {
            y = 0;
          }
          /*set the position of the lens:*/
          lens.style.left = x + "px";
          lens.style.top = y + "px";
          /*display what the lens "sees":*/
          result.style.backgroundPosition =
            "-" + x * cx + "px -" + y * cy + "px";
        }
        function getCursorPos(e) {
          var a,
            x = 0,
            y = 0;
          e = e || window.event;
          /*get the x and y positions of the image:*/
          a = img.getBoundingClientRect();
          /*calculate the cursor's x and y coordinates, relative to the image:*/
          x = e.pageX - a.left;
          y = e.pageY - a.top;
          /*consider any page scrolling:*/
          x = x - window.pageXOffset;
          y = y - window.pageYOffset;
          return { x: x, y: y };
        }
      }
    </script>
    <script>
      $(function () {
        var num = 36; // the total number of images
        var currentImg = 1;
        var isSwiping = false;
        var swipeDelay = 100; // delay between image changes in milliseconds
        var zoomTimeout;

        // Preload all the images into hidden div
        for (var i = 1; i <= num; i++) {
          var img = document.createElement("img");
          img.src =
            "http://woosterwebdesign.com/experiments/images/car_slides/car_(" +
            i +
            ").jpg";
          document.getElementById("preload-imgs").appendChild(img);
        }

        // Control swipes using jquery.touchSwipe.min.js
        var swipeOptions = {
          triggerOnTouchEnd: true,
          swipeStatus: swipeStatus,
          allowPageScroll: "vertical",
          threshold: 75,
        };

        $(".img-container").swipe(swipeOptions);

        function swipeStatus(event, phase, direction, distance) {
          if (
            phase === "move" &&
            (direction === "left" || direction === "right") &&
            !isSwiping
          ) {
            isSwiping = true;
            setTimeout(function () {
              var imgNum = Math.floor(distance / 10);
              if (direction === "left") {
                currentImg += imgNum;
              } else if (direction === "right") {
                currentImg -= imgNum;
              }

              if (currentImg > num) {
                currentImg = 1;
              } else if (currentImg < 1) {
                currentImg = num;
              }

              document.getElementById("imgContainer").style.backgroundImage =
                "url('http://woosterwebdesign.com/experiments/images/car_slides/car_(" +
                currentImg +
                ").jpg')";
              isSwiping = false;
            }, swipeDelay);
          }
        }

        // Add touch event listener for zoom effect
        $(".img-container").on("touchstart", function (event) {
          clearTimeout(zoomTimeout);
          var touch = event.touches[0];
          var container = $(this);
          var offset = container.offset();
          var relativeX =
            ((touch.pageX - offset.left) / container.width()) * 100;
          var relativeY =
            ((touch.pageY - offset.top) / container.height()) * 100;
          container.css(
            "background-position",
            relativeX + "% " + relativeY + "%"
          );
          container.addClass("zoom");
        });

        $(".img-container").on("touchend", function (event) {
          zoomTimeout = setTimeout(function () {
            $("#imgContainer").removeClass("zoom");
            $("#imgContainer").css("background-position", "center");
          }, 300); // Duration of zoom effect after touch end
        });
      });
    </script>
  </body>
</html>
